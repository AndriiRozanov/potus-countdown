<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Redirect…</title>
  <meta name="robots" content="noindex">
  <style>
    html,body{height:100%}body{margin:0;display:grid;place-items:center;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    .box{max-width:620px;padding:24px;text-align:center}
    a{color:#2563eb;text-decoration:none}a:hover{text-decoration:underline}
  </style>
  <script>
    (function () {
      const SUPPORTED = ['uk','en','de','es','fr'];

      // Helper: normalize lang -> base code (e.g. 'en-US' -> 'en')
      const base = s => (s||'').toLowerCase().split('-')[0];

      // Read candidates: query ?lang=, localStorage, navigator.languages
      const url = new URL(location.href);
      let cand = base(url.searchParams.get('lang'));

      try {
        if (!cand) cand = base(localStorage.getItem('lang'));
      } catch(e){}

      if (!cand) {
        const nav = (navigator.languages && navigator.languages.length)
          ? navigator.languages : [navigator.language || 'en'];
        for (const l of nav) {
          const b = base(l);
          if (b === 'ua') { cand = 'uk'; break; }          // map ua -> uk
          if (SUPPORTED.includes(b)) { cand = b; break; }
        }
      }

      if (cand === 'ua') cand = 'uk';
      if (!SUPPORTED.includes(cand)) cand = 'en';

      // Persist choice (so наступні візити не питають)
      try { localStorage.setItem('lang', cand); } catch(e){}

      // Compute base path (works for domain root "/" and for "/repo/")
      // Example: "/repo/index.html" -> "/repo/"; "/" -> "/"
      const basePath = location.pathname.endsWith('/')
        ? location.pathname
        : location.pathname.replace(/[^\/]*$/, '');

      // Build target URL: /<lang>/ + keep other params (except ?lang) + hash
      const target = new URL(location.href);
      target.pathname = basePath.replace(/\/+$/,'/') + cand + '/';
      target.searchParams.delete('lang');
      const href = target.toString();

      // Redirect
      location.replace(href);
    })();
  </script>
</head>
<body>
  <div class="box">
    <h1>Redirecting…</h1>
    <p>If you are not redirected automatically, choose your language:</p>
    <p>
      <a href="./uk/">Українська</a> ·
      <a href="./en/">English</a> ·
      <a href="./de/">Deutsch</a> ·
      <a href="./es/">Español</a> ·
      <a href="./fr/">Français</a>
    </p>
  </div>
  <noscript>
    <meta http-equiv="refresh" content="0; url=./en/">
  </noscript>
</body>
</html>
